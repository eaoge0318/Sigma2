# Y 軸手動調整功能 - 實現完成

## ✅ 已完成的修改

### 1. JavaScript 修改 (`static/js/dashboard_full.js`)

#### 全域變數 (已加入)
```javascript
// Y 軸範圍控制
let yAxisMode = 'auto';  // 'auto' 或 'manual'
let yAxisManualMin = null;
let yAxisManualMax = null;
```

#### createChart 函數 (已修改)
- 根據 `yAxisMode` 決定使用自動或手動範圍
- 自動模式: `[LSL × 0.9, USL × 1.1]`
- 手動模式: 使用 `yAxisManualMin` 和 `yAxisManualMax`

#### 控制函數 (已加入)
- `toggleYAxisMode()` - 切換自動/手動模式
- `updateYAxisModeButton()` - 更新按鈕文字和樣式
- `applyManualYAxisRange()` - 套用手動設定的範圍
- `recreateAllCharts()` - 重新建立所有圖表

### 2. HTML UI (待加入)

UI 片段已建立在: `.agent/y_axis_control_ui.html`

**需要將此 HTML 加入到 `dashboard.html` 的適當位置**,建議位置:
- 圖表區域的頂部
- 與 "Reset Monitor" 按鈕同一區域
- 或側邊欄的控制面板中

---

## 🎯 功能說明

### 自動模式 (預設)
- Y 軸範圍根據 LSL/USL 自動計算
- 範圍 = [LSL × 0.9, USL × 1.1] (預留 10% 緩衝)
- 按鈕顯示: 🔄 自動範圍 (綠色)

### 手動模式
- 點擊按鈕切換到手動模式
- 按鈕變為: ✏️ 手動範圍 (橙色)
- 顯示輸入框,可設定最小值和最大值
- 點擊"套用"按鈕更新所有圖表

---

## 📋 使用步驟

### 切換到手動模式
1. 點擊 "🔄 自動範圍" 按鈕
2. 按鈕變為 "✏️ 手動範圍"
3. 輸入框自動填入當前的自動範圍

### 調整範圍
1. 在"最小值"輸入框輸入數值 (例如: 1.5)
2. 在"最大值"輸入框輸入數值 (例如: 2.5)
3. 點擊"套用"按鈕
4. 所有圖表立即更新

### 切換回自動模式
1. 再次點擊 "✏️ 手動範圍" 按鈕
2. 按鈕變回 "🔄 自動範圍"
3. 輸入框隱藏,恢復自動計算

---

## 🔍 技術細節

### 範圍計算邏輯

```javascript
// 在 createChart 函數中
let yMin, yMax;
if (yAxisMode === 'manual' && yAxisManualMin !== null && yAxisManualMax !== null) {
    // 手動模式
    yMin = yAxisManualMin;
    yMax = yAxisManualMax;
} else {
    // 自動模式
    yMin = deadzone[0] * 0.9;  // LSL - 10%
    yMax = deadzone[1] * 1.1;  // USL + 10%
}
```

### 圖表重建流程

當切換模式或套用新範圍時:
1. 銷毀所有現有圖表 (`chart.destroy()`)
2. 清空圖表容器
3. 調用 `updateDashboard()` 重新建立圖表
4. 新圖表使用更新後的 Y 軸範圍

---

## ⚠️ 注意事項

1. **手動設定會保留**: 切換到手動模式後,即使載入新模型,範圍也不會改變
2. **驗證輸入**: 系統會檢查輸入的數值是否有效,最小值必須小於最大值
3. **即時更新**: 點擊"套用"後,所有圖表會立即重新繪製
4. **預設值**: 首次切換到手動模式時,會自動填入當前的自動範圍

---

## 📍 下一步: 加入 HTML UI

請將 `.agent/y_axis_control_ui.html` 中的 HTML 片段加入到 `dashboard.html` 的適當位置。

建議位置:
```html
<!-- 在圖表區域的頂部,例如: -->
<div id="charts-wrapper">
    <!-- 在這裡加入 Y 軸控制 UI -->
    
    <!-- 圖表會動態加入到這裡 -->
</div>
```

或者告訴我您想要放在哪裡,我可以幫您找到確切的位置並加入。

---

## ✅ 測試檢查清單

- [ ] 頁面載入後,按鈕顯示 "🔄 自動範圍" (綠色)
- [ ] 點擊按鈕,切換到 "✏️ 手動範圍" (橙色)
- [ ] 輸入框顯示,並填入當前範圍
- [ ] 修改數值後點擊"套用",圖表更新
- [ ] 再次點擊按鈕,切換回自動模式
- [ ] 輸入框隱藏,圖表恢復自動範圍
- [ ] 載入新模型後,自動模式會更新範圍
- [ ] 手動模式下,載入新模型不會改變範圍

---

## 🎨 UI 預覽

```
┌─────────────────────────────────────────────────────────────┐
│ [🔄 自動範圍]  💡 提示: 自動模式會根據 LSL/USL 調整範圍      │
└─────────────────────────────────────────────────────────────┘

切換到手動模式後:

┌─────────────────────────────────────────────────────────────┐
│ [✏️ 手動範圍]  Y 軸範圍: [1.50] ~ [2.50] [套用]              │
│                💡 提示: 自動模式會根據 LSL/USL 調整範圍      │
└─────────────────────────────────────────────────────────────┘
```

---

## 📝 總結

✅ **JavaScript 功能已完成**
✅ **UI 片段已建立**
⏳ **待加入 HTML 到 dashboard.html**

所有後端和 JavaScript 邏輯都已實現,只需要將 UI 加入到頁面中即可使用!
